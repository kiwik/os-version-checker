<html>
<head>
<title>Openstack versions info</title>
<script type="text/javascript" charset="utf8" src="https://code.jquery.com/jquery-3.5.1.js"></script>
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.21/css/jquery.dataTables.css">
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.21/js/jquery.dataTables.js"></script>
<style>
.MISSING.sorting_1 {background-color: #F1948A !important; font-weight: bold;}
.OUTDATED.sorting_1 {background-color: #F0B27A !important; font-weight: bold;}
.OK.sorting_1 {background-color: #7DCEA0 !important; font-weight: bold;}
.NONE.sorting_1 {background-color: #B2BABB !important; font-weight: bold;}
.MISSING {background-color: #F1948A !important; font-weight: bold;}
.OUTDATED {background-color: #F0B27A !important; font-weight: bold;}
.OK {background-color: #7DCEA0 !important; font-weight: bold;}
.NONE {background-color: #B2BABB !important; font-weight: bold;}
.invisible tr {
  border: none !important;
  border-size: 0;
}
.btn_release {
  padding: 5px 15px;
  text-align: center;
  text-decoration: none;
  display: inline-block;
  font-size: 15px;
  cursor: pointer;
  font-weight: bold;
}
.btn_release_clicked {
  padding: 5px 15px;
  text-align: center;
  text-decoration: none;
  display: inline-block;
  font-size: 15px;
  cursor: pointer;
  font-weight: bold;
  background: #B2BABB;
}
</style>
<script>
$(document).ready( function () {
{%- for release in data %}
  {%- set comparasions = data[release] %}
  {%- for comparasion in comparasions %}
  $('#table-{{- release }}-{{- comparasion }}').DataTable();
  {%- endfor %}
{%- endfor %}
} );
</script>
<script>
window.onload = function(){
{%- for release in data %}
  document.getElementById("button-{{ release }}").onclick = function () {
    displayTable('{{release}}','{{ data[release] | first }}')
  }
{%- endfor %}
  document.getElementById("button-{{ data | first }}").className = 'btn_release_clicked';
  document.getElementById("div-{{ data | first }}").style.display = "block";
  document.getElementById("div-{{ data | first }}-{{ data[data | first] | first }}").style.display = "block";
}
</script>
<script>
function displayTable(release,comparasion){
  var tableToDisplay = document.getElementById("div-".concat(release,"-",comparasion));
  var sectionToDisplay = document.getElementById("div-".concat(release));
  var buttonToClicked = document.getElementById("button-".concat(release));
  var optionToSelected = document.getElementById("select-".concat(release));
  var sections = document.getElementsByName("div-section");
  var tables = document.getElementsByName("div-table");
  var buttons = document.getElementsByName("button-release");
  sections.forEach(element => element.style.display = "none");
  tables.forEach(element => element.style.display = "none");
  buttons.forEach(element => element.className = "btn_release");
  sectionToDisplay.style.display = "block";
  tableToDisplay.style.display = "block";
  buttonToClicked.className = "btn_release_clicked";
  optionToSelected.value = comparasion;
}
function selectComparasion(release,selectId) {
  var selectElement = document.getElementById(selectId);
  var comparasion = selectElement.options[selectElement.selectedIndex].text;
  displayTable(release,comparasion)
  return false;
}
</script>
</head>
<body>
<table id="table-switcher" class="switcher">
  <tr>
    <td>
      Generated: {{ time }}
    </td>
  </tr>
  <tr></tr>
  <tr>
    <td class="invisible" colspan="5">
      {%- for release in data %}
      <input type="button" name="button-release" id="button-{{ release }}" value="{{ release }}" class="btn_release">
      {%- endfor %}
    </td>
  </tr>
</table>
<br>
{%- for release in data %}
  {%- set comparasions = data[release] %}
<div name="div-section" id="div-{{- release }}" style="display: none;">
  <form id="form-{{ release }}" action="javascript:selectComparasion('{{ release }}','select-{{release}}');">
    <label for="comparasion">Comparasion: </label>
    <select name="select-comparasion" id="select-{{ release }}">
      {%- for comparasion in comparasions %}
      <option value="{{ comparasion }}">{{- comparasion }}</option>
      {%- endfor %}
    </select>
    <input type="submit" id="submit-{{ release }}" value="Select">
  </form>

  {%- for comparasion in comparasions %}
    {%- set packages = comparasions[comparasion]['data'] %}
    <div name="div-table" id="div-{{- release }}-{{- comparasion }}" style="display: none;">
      <table id="table-{{- release }}-{{- comparasion}}" class="display" data-page-length='{{ packages|length }}'>
        <thead>
          <tr>
            <th>#</th>
            <th>Package</th>
    {%- if comparasion == 'upstream-debian' %}
            <th>Upstream<br>version</th>
            <th>Debian<br>version</th>
    {%- else %}
            <th>Debian<br>version</th>
            <th>Image<br>version</th>
    {%- endif %}
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
    {%- for package in packages %}
    {%- set package_data = comparasions[comparasion]['data'][package] %}
          <tr>
            <td>{{ loop.index }}.</td>
            <td>{{ package }}</td>
            <td>{{ package_data['base_package_version'] }}</td>
            <td>{{ package_data['comparison_package_version'] }}</td>
            <td class="{{ package_data['status'] }} sorting_1">{{ package_data['status'] }}</td>
          </tr>
    {%- endfor %}
      </tbody>
    </table>
  </div>
  {%- endfor %}
</div>
{%- endfor %}
</body>
